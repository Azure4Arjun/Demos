<# If you want to know more about the Vulnerabilit-yAssessment feature, 
    stop by the SQL Server team's booth  #>
Invoke-SqlVulnerabilityAssessmentScan -ServerInstance localhost\SQL2017 -DatabaseName WideWorldImporters

<# Saving the Results #>
$scanResult = Invoke-SqlVulnerabilityAssessmentScan -ServerInstance "localhost\SQL2017" -Database WideWorldImporters
$scanResult | Export-SqlVulnerabilityAssessmentScan -FolderPath "C:\temp\Vulnerability Assessment Reports\WideWorldImporters_ScanResult.xlsx"


<# Run the scan against every database on every instance #>
foreach ($Instance in dir 'SQLSERVER:\SQLRegistration\Database Engine Server Group' )
{
    (Get-SqlDatabase -ServerInstance $Instance.Name).Where({$_.IsSystemObject -eq $false}) |
    foreach {
            Invoke-SqlVulnerabilityAssessmentScan -ServerInstance $_.Parent -Database $_.Name |
            Export-SqlVulnerabilityAssessmentScan -FolderPath "C:\temp\Vulnerability Assessment Reports\$(($_.Parent).Name -replace '\\', '_' )_$($_.Name)_ScanResult.xlsx"
            }
};


Invoke-Item 'C:\temp\Vulnerability Assessment Reports\'